# VoV Protocol Specification

## ğŸ“Œ Overview
VoVï¼ˆVoid on Voiceï¼‰ã¯ã€åŒ¿åãƒ»åˆ†æ•£å‹é€šä¿¡åŸºç›¤ã§ã‚ã‚Šã€å‹•çš„ã«é€šä¿¡ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã€ç™ºä¿¡è€…ãƒ»å—ä¿¡è€…ã®ç’°å¢ƒã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã§é€šä¿¡ã‚’æˆç«‹ã•ã›ã¾ã™ã€‚æœ¬ä»•æ§˜æ›¸ã¯ã€VoVã®é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«éšå±¤ã¨æ§‹é€ ã€ãŠã‚ˆã³ãƒ‡ãƒ¼ã‚¿è»¢é€ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚

---

## ğŸ”¹ Protocol Layer Structure

```
+------------------------------+
| User Layer                  |
|  - UI, Input, Message View  |
+------------------------------+
| Profiler Layer              |
|  - NATåˆ¤å®š, å¸¯åŸŸæ¸¬å®š         |
+------------------------------+
| Model Selection Layer       |
|  - CommModelé¸æŠ             |
+------------------------------+
| Communication Layer         |
|  - Low/Balanced/High Load   |
+------------------------------+
| VoV VC Layer (Core)         |
|  - NodeIDè§£æ±º, ä¸­ç¶™,å„ªå…ˆåˆ¶å¾¡ |
+------------------------------+
| Storage Layer               |
|  - åˆ†æ•£æ ¼ç´, å¾©å…ƒå‡¦ç†        |
+------------------------------+
```

---

## ğŸ”¸ NodeID & Identity
- **NodeID**: `SHA256(PublicKey)` ã«ã‚ˆã‚Šæ±ºå®šã€‚IDã¯å¤‰æ›´ä¸å¯ã€‚
- **KeyPair**: ECDSA (secp256k1) ã«ã‚ˆã‚‹å…¬é–‹éµæš—å·
- **Routing**: NodeIDãƒ™ãƒ¼ã‚¹ã§DHTã‚’ç”¨ã„ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†

---

## ğŸ”¸ Comm Model Selection Protocol

### Input (from Profiler)
```json
{
  "natType": "symmetric",
  "bandwidthUp": 0.5,
  "latencyMs": 120,
  "isMobile": true
}
```

### Logic
| æ¡ä»¶ | ãƒ¢ãƒ‡ãƒ«é¸æŠ |
|------|-------------|
| NATãŒSymmetric ã¾ãŸã¯ãƒ¢ãƒã‚¤ãƒ« | Low Load Model |
| ä¸Šã‚Šå¸¯åŸŸ > 5Mbpsã€å®‰å®š | High Load Model |
| ãã‚Œä»¥å¤– | Balanced Model |

---

## ğŸ”¸ Communication Models

### Low Load Model
- **Transport**: HTTP Long Poll, MQTT
- **Encryption**: TLS 1.3 + VoVæš—å·åŒ–ï¼ˆAES-CTR + Nodeç½²åï¼‰
- **Reliability**: ä¸­ç¶™å¿…é ˆã€å†é€åˆ¶å¾¡ã‚ã‚Š

### Balanced Model
- **Transport**: UDP Gossip + DHT Lookup
- **Message**: `MSG_ID + TTL + PAYLOAD`
- **Gossipåˆ¶å¾¡**: é‡è¤‡é™¤å»ã€TTLå‰Šæ¸›ã€é€ä¿¡åˆ¶é™

### High Load Model
- **Transport**: libp2p Direct + Relay Mesh
- **Routing**: AutoNAT + Kademlia
- **å¸¸æ™‚æ¥ç¶š**: Direct Channelç¶­æŒã€Ping/Pongç¶­æŒ

---

## ğŸ”¸ VoV VC Layerï¼ˆCore Protocolï¼‰

### NodeID Registry
- `PUT`: NodeID â†’ IP + Port + Capability
- `GET`: NodeID â†’ ç¾åœ¨ã®åˆ°é”å¯èƒ½çµŒè·¯
- TTLæ›´æ–°ï¼‹ç½²åä»˜ãæ›´æ–°ï¼ˆæ”¹ã–ã‚“é˜²æ­¢ï¼‰

### Relay Mesh
- ãƒãƒ«ãƒRelayç™»éŒ²æ–¹å¼ã€æœ€çŸ­3ã¤ä»¥ä¸Šä¿æŒæ¨å¥¨
- ä¸­ç¶™çµŒè·¯ã¯ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ or RTTå„ªå…ˆ

### Address Virtualization
- IPéå…¬é–‹ã€NodeIDæŒ‡å®šã§é€šä¿¡è¦æ±‚
- åˆæœŸã¯Relayã€æˆåŠŸå¾ŒDirectã«åˆ‡æ›¿

### Prioritizer
- `storageScore` ã«ã‚ˆã‚Šå„ªå…ˆåº¦ä»˜åŠ 
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¯ã«QoSã‚¯ãƒ©ã‚¹ã‚’å‹•çš„è¨ˆç®—

---

## ğŸ”¸ Storage Protocol

### æ ¼ç´å½¢å¼ï¼ˆæ–­ç‰‡ï¼‰
```json
{
  "fragmentID": "uuid",
  "nodeID": "...",
  "contentHash": "sha256",
  "payload": "...base64...",
  "expires": 1680000000
}
```

### åˆ†æ•£å†—é•·æ–¹å¼
- XORãƒ™ãƒ¼ã‚¹Erasure Coding
- æœ€ä½Nç‰‡ä¸­Kç‰‡ã§å¾©å…ƒå¯

### å¾©å…ƒæ™‚
- å–å¾—å¤±æ•—: RelayMeshçµŒç”±ã§å†è¦æ±‚
- ä¸æ­£æ–­ç‰‡: ç½²åä¸ä¸€è‡´ã«ã‚ˆã‚‹ç ´æ£„

---

## ğŸ”š Security Notes
- ã™ã¹ã¦ã®é€šä¿¡ã¯Nodeç½²åä»˜ãæš—å·ãƒ‘ã‚±ãƒƒãƒˆ
- Metadata leakageæœ€å°åŒ–
- ä¸­ç¶™ãƒãƒ¼ãƒ‰ã‚‚å«ã‚ã€IP/Nodeåˆ†é›¢ã•ã‚ŒãŸãƒ­ã‚°ç®¡ç†

---

æœ¬ä»•æ§˜ã¯åˆç‰ˆã§ã‚ã‚Šã€å®Ÿè£…ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«å¿œã˜ã¦æ‹¡å¼µå¯èƒ½ã§ã™ã€‚
