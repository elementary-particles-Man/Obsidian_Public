@startuml
!pragma layout smetana
left to right direction
skinparam componentStyle rectangle

actor User

' === VoV 通信構造の最上層 ===
component "User UI\n[投稿・操作]" as UIC
component "Environment Profiler\n[NAT / 帯域 / スマホ判定]" as Profiler
component "Comm Model Selector\n[動的通信選択器]" as ModeSelector

User --> UIC : 投稿/操作
UIC --> Profiler
Profiler --> ModeSelector

' === 通信モデル分岐（3モード） ===
component "Low Load Model\n[HTTP / MQTT Relay]" as LL
component "Balanced Model\n[UDP Gossip / DHT]" as BM
component "High Load Model\n[libp2p + NAT Traversal]" as HL

ModeSelector --> LL : モバイル / 制限環境
ModeSelector --> BM : 通常ネットワーク
ModeSelector --> HL : 高速 / 静的IP

' === VoV VC Layer（仮想通信/NodeIDルーティング） ===
package "VoV VC Layer\n[Void Creation Layer]" {
  component "NodeID Registry\n[DHT / Kademlia]" as NodeIDReg
  component "Relay Mesh\n[中継/到達支援]" as RelayMesh
  component "Virtual Addressing\n[NodeID ⇄ IP解決]" as AddrMap
  component "Prioritizer\n[ストレージ貢献判定]" as Prioritizer
  component "Direct Node Channel\n[常時通信構築]" as DirectChan
}

LL --> RelayMesh
BM --> AddrMap
HL --> NodeIDReg
HL --> RelayMesh
HL --> DirectChan

AddrMap --> NodeIDReg
NodeIDReg --> RelayMesh
DirectChan --> Prioritizer
Prioritizer --> RelayMesh

' === データ層（共通） ===
database "Distributed Storage" as Storage

RelayMesh --> Storage
DirectChan --> Storage

@enduml
